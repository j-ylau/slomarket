(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{634:function(e,t,r){"use strict";var i=r(6314);t.Z=void 0;var n=i(r(984)),o=r(7437),s=(0,n.default)((0,o.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"AddCircleOutline");t.Z=s},6858:function(e,t,r){Promise.resolve().then(r.bind(r,1304))},1304:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page},dynamic:function(){return W}});var i=r(7437),n=r(2265),o=r(4033),s=r(4086),a=r(148),c=r(4165),l=r(3671),d=r(3457),u=r(9050),h=r(7292),p=r(7070),g=r(4081),x=r(819),m=r(654),f=r(1417),Filters_SortFilter=e=>{let{value:t,onChange:r}=e;return(0,i.jsxs)(g.Z,{variant:"outlined",sx:{mb:2,minWidth:120},children:[(0,i.jsx)(x.Z,{children:"Sort By"}),(0,i.jsxs)(m.Z,{value:t,onChange:e=>r(e.target.value),label:"Sort By",children:[(0,i.jsx)(f.Z,{value:"priceLowest",children:"Price: Lowest First"}),(0,i.jsx)(f.Z,{value:"priceHighest",children:"Price: Highest First"}),(0,i.jsx)(f.Z,{value:"newest",children:"Newly Listed"})]})]})},v=r(182),Z=r(791),j=r(3428),C=r(7042),y=r(5600),k=r(9975),S=r(8682),F=r(9782),w=(0,F.Z)((0,i.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),b=(0,F.Z)((0,i.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),M=(0,F.Z)((0,i.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox"),z=r(8702),L=r(7927),A=r(5843),P=r(6520),H=r(5702);function getCheckboxUtilityClass(e){return(0,H.Z)("MuiCheckbox",e)}let I=(0,P.Z)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),E=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],useUtilityClasses=e=>{let{classes:t,indeterminate:r,color:i,size:n}=e,o={root:["root",r&&"indeterminate",`color${(0,z.Z)(i)}`,`size${(0,z.Z)(n)}`]},s=(0,y.Z)(o,getCheckboxUtilityClass,t);return(0,j.Z)({},t,s)},V=(0,A.ZP)(S.Z,{shouldForwardProp:e=>(0,A.FO)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,r.indeterminate&&t.indeterminate,t[`size${(0,z.Z)(r.size)}`],"default"!==r.color&&t[`color${(0,z.Z)(r.color)}`]]}})(({theme:e,ownerState:t})=>(0,j.Z)({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${"default"===t.color?e.vars.palette.action.activeChannel:e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,k.Fq)("default"===t.color?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==t.color&&{[`&.${I.checked}, &.${I.indeterminate}`]:{color:(e.vars||e).palette[t.color].main},[`&.${I.disabled}`]:{color:(e.vars||e).palette.action.disabled}})),B=(0,i.jsx)(b,{}),_=(0,i.jsx)(w,{}),O=(0,i.jsx)(M,{}),N=n.forwardRef(function(e,t){var r,o;let s=(0,L.Z)({props:e,name:"MuiCheckbox"}),{checkedIcon:a=B,color:c="primary",icon:l=_,indeterminate:d=!1,indeterminateIcon:u=O,inputProps:h,size:p="medium",className:g}=s,x=(0,Z.Z)(s,E),m=d?u:l,f=d?u:a,v=(0,j.Z)({},s,{color:c,indeterminate:d,size:p}),y=useUtilityClasses(v);return(0,i.jsx)(V,(0,j.Z)({type:"checkbox",inputProps:(0,j.Z)({"data-indeterminate":d},h),icon:n.cloneElement(m,{fontSize:null!=(r=m.props.fontSize)?r:p}),checkedIcon:n.cloneElement(f,{fontSize:null!=(o=f.props.fontSize)?o:p}),ownerState:v,ref:t,className:(0,C.Z)(y.root,g)},x,{classes:y}))});var Filters_VerifiedFilter=e=>{let{checked:t,onChange:r}=e;return(0,i.jsx)(v.Z,{control:(0,i.jsx)(N,{checked:t,onChange:e=>r(e.target.checked)}),label:"Verified User Only"})},components_FilterComponent=e=>{let{onFilterChange:t}=e,[r,o]=(0,n.useState)(""),[s,a]=(0,n.useState)(""),[c,l]=(0,n.useState)(!1),[g,x]=(0,n.useState)(null),[m,f]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{""!==s&&navigator.geolocation.getCurrentPosition(e=>{x({latitude:e.coords.latitude,longitude:e.coords.longitude})},e=>{console.error("Error getting location: ",e)})},[s]),(0,i.jsxs)(d.Z,{direction:"row",spacing:3,display:"flex",flexDirection:"row",p:2,alignItems:"center",children:[(0,i.jsx)(Filters_SortFilter,{value:r,onChange:o}),(0,i.jsx)(Filters_VerifiedFilter,{checked:c,onChange:l}),(0,i.jsx)(u.Z,{onClick:()=>{if(""!==s&&!g){alert("Location is not available.");return}t({sort:r,radius:""!==s?s:null,verified:c,userLocation:""!==s?g:null}),f(!0)},variant:"contained",color:"primary",sx:{mt:2},children:"Apply Filters"}),(0,i.jsx)(h.Z,{open:m,autoHideDuration:6e3,onClose:()=>f(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,i.jsx)(p.Z,{onClose:()=>f(!1),severity:"success",sx:{width:"100%"},children:"Filters applied successfully!"})})]})},q=r(2063),$=r(9245),D=r(6882),R=r(3226),U=r(8874),J=r(2492),T=r(634);let W="force-static";function deg2rad(e){return e*(Math.PI/180)}var page=()=>{let e=(0,o.useSearchParams)(),[t,r]=(0,n.useState)([]),[h,p]=(0,n.useState)(!1),[g,x]=(0,n.useState)(1),[m,f]=(0,n.useState)({sort:"",radius:5,verified:!1});(0,n.useEffect)(()=>{let t=e.get("query");t&&performSearch(t)},[e]);let performSearch=async e=>{p(!0);try{let t=(0,s.hJ)(a.db,"listings"),i=[],n=await (0,s.PL)(t);n.forEach(t=>{try{let r=t.data();passesFilters(r,e)&&i.push({id:t.id,...r})}catch(e){console.error("Error processing document",t.id,e)}}),i=applyAdditionalFilters(i),r(i)}catch(e){console.error("Error fetching search results: ",e)}p(!1)},passesFilters=(e,t)=>{let r=t.toLowerCase(),i=e.description.toLowerCase().includes(r)||e.category.toLowerCase().includes(r)||e.title.toLowerCase().includes(r),n=!m.verified||m.verified&&e.studentVerification;return i&&n&&!0},applyAdditionalFilters=e=>("priceLowest"===m.sort?e.sort((e,t)=>parseFloat(e.price)-parseFloat(t.price)):"priceHighest"===m.sort&&e.sort((e,t)=>parseFloat(t.price)-parseFloat(e.price)),"newest"===m.sort&&e.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)),m.userLocation&&m.radius&&(e=e.filter(e=>{let t=function(e,t,r,i){let n=deg2rad(r-e),o=deg2rad(i-t),s=Math.sin(n/2)*Math.sin(n/2)+Math.cos(deg2rad(e))*Math.cos(deg2rad(r))*Math.sin(o/2)*Math.sin(o/2);return 3958.8*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}(m.userLocation.latitude,m.userLocation.longitude,e.location.latitude,e.location.longitude);return t<=parseFloat(m.radius)})),e);return(0,i.jsxs)($.Z,{p:3,children:[(0,i.jsx)(components_FilterComponent,{onFilterChange:t=>{f(t),performSearch(e.get("query"))}}),(0,i.jsx)(q.Z,{}),(0,i.jsx)(R.Z,{variant:"h4",sx:{marginBottom:2,color:"#2B7257"},children:(0,i.jsxs)("strong",{children:["Searching for: ",e.get("query")]})}),h?(0,i.jsx)($.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,i.jsx)(D.Z,{})}):0===t.length?(0,i.jsxs)($.Z,{textAlign:"center",p:30,children:[(0,i.jsxs)(R.Z,{variant:"h5",gutterBottom:!0,children:["No listings for ",e.get("query"),". Make one from here!"]}),(0,i.jsx)(u.Z,{variant:"contained",color:"primary",startIcon:(0,i.jsx)(T.Z,{}),href:"create-listing",children:"Create Listing"})]}):(0,i.jsxs)($.Z,{p:0,children:[(0,i.jsx)(U.ZP,{container:!0,spacing:2,children:t.slice((g-1)*20,20*g).map((e,t)=>(0,i.jsx)(U.ZP,{item:!0,xs:12,sm:12,md:4,lg:3,xl:2.4,children:(0,i.jsx)(c.Z,{loading:h,listingId:e.id,title:e.title,createdAt:e.createdAt,updatedAt:e.updatedAt,description:e.description,images:e.images,location:e.location,price:e.price,studentVerification:e.studentVerification,priceHistory:e.priceHistory})},e.id))}),(0,i.jsx)(d.Z,{spacing:2,alignItems:"center",marginY:5,children:(0,i.jsx)(J.Z,{count:Math.ceil(t.length/20),page:g,onChange:(e,t)=>{x(t)}})})]}),(0,i.jsx)(l.Z,{})]})}},2063:function(e,t,r){"use strict";var i=r(7437);r(2265);var n=r(6055),o=r(3457),s=r(7827),a=r(4033);t.Z=()=>{let e=(0,a.useRouter)(),handleCategoryClick=t=>{e.push("/search?query=".concat(t))};return(0,i.jsx)(n.Z,{elevation:0,sx:{p:2,backgroundColor:"transparent",overflow:"auto"},children:(0,i.jsx)(o.Z,{direction:"row",spacing:1,justifyContent:"flex-start",alignItems:"center",sx:{gap:{xs:"10px",sm:"20px"},justifyContent:"center",flexWrap:"wrap"},children:["Furniture","Electronics","School Supplies","Home Decor","Clothing and Accessories","Appliances","Bicycles and Transportation","Textbooks","Sports and Fitness Equipment","Home Office","Miscellaneous"].map((e,t)=>(0,i.jsx)(s.Z,{label:e,onClick:()=>handleCategoryClick(e),variant:"outlined"},t))})})}},3671:function(e,t,r){"use strict";var i=r(7437),n=r(2265),o=r(4086),s=r(148),a=r(4165),c=r(9245),l=r(3226),d=r(8874);t.Z=e=>{let{isHomePage:t}=e,[r,u]=(0,n.useState)([]),[h,p]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let fetchNewItems=async()=>{p(!0);let e=(0,o.IO)((0,o.hJ)(s.db,"listings"),(0,o.Xo)("createdAt","desc"),(0,o.b9)(10)),t=await (0,o.PL)(e),r=[];t.forEach(e=>{r.push({id:e.id,...e.data()})}),u(r),p(!1)};fetchNewItems()},[]),(0,i.jsxs)(c.Z,{p:3,children:[!t&&(0,i.jsx)(l.Z,{variant:"h4",sx:{marginBottom:2,color:"#2B7257"},children:(0,i.jsx)("strong",{children:"New Listings"})}),(0,i.jsx)(d.ZP,{container:!0,spacing:2,children:r.map(e=>(0,i.jsx)(d.ZP,{item:!0,xs:12,sm:12,md:4,lg:3,xl:2.4,children:(0,i.jsx)(a.Z,{loading:h,listingId:e.id,id:e.id,title:e.title,createdAt:e.createdAt,updatedAt:e.updatedAt,description:e.description,images:e.images,location:e.location,price:e.price,studentVerification:e.studentVerification,priceHistory:e.priceHistory})},e.id))})]})}}},function(e){e.O(0,[358,220,990,87,880,980,599,214,739,787,116,630,546,991,856,6,971,472,744],function(){return e(e.s=6858)}),_N_E=e.O()}]);