(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{9396:function(e,t,r){"use strict";var n=r(6314);t.Z=void 0;var i=n(r(984)),a=r(7437),s=(0,i.default)((0,a.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");t.Z=s},3533:function(e,t,r){"use strict";var n=r(6314);t.Z=void 0;var i=n(r(984)),a=r(7437),s=(0,i.default)((0,a.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");t.Z=s},5136:function(e,t,r){Promise.resolve().then(r.bind(r,1840))},148:function(e,t,r){"use strict";r.d(t,{I8:function(){return c},db:function(){return l},tO:function(){return u}});var n=r(994);r(5073);var i=r(4086),a=r(9584),s=r(8153);let o=(0,n.ZF)({apiKey:"AIzaSyBjEHdFQZFsfN-RGa59n16XO7qQ4dhFsAo",authDomain:"slomarket-ebbd9.firebaseapp.com",projectId:"slomarket-ebbd9",storageBucket:"slomarket-ebbd9.appspot.com",messagingSenderId:"247606192779",appId:"1:247606192779:web:421bdc33c388c5c8e828e",measurementId:"G-E3DPKJ6L5V"}),c=(0,s.v0)(o),l=(0,i.ad)(o),u=(0,a.cF)(o)},5959:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return AuthProvider},useAuth:function(){return useAuth}});var n=r(7437),i=r(2265),a=r(148),s=r(8153);let o=(0,i.createContext)();function useAuth(){return(0,i.useContext)(o)}function AuthProvider(e){let{children:t}=e,[r,c]=(0,i.useState)(),[l,u]=(0,i.useState)(!0);async function isAdmin(){return await a.I8.currentUser.getIdTokenResult().then(e=>!!e.claims.admin).catch(e=>{throw e})}return(0,i.useEffect)(()=>{let e=a.I8.onAuthStateChanged(e=>{c(e),u(!1)},e=>{console.error("Authentication error:",e),u(!1)});return e},[]),(0,n.jsx)(o.Provider,{value:{currentUser:r,getUser:function(){return a.I8.currentUser},isLoggedIn:function(){return null!==a.I8.currentUser},isAdmin,login:function(e,t){return a.I8.signInWithEmailAndPassword(e,t)},signOut:function(){return a.I8.signOut()},signUp:function(e,t){return(0,s.Xb)(a.I8,e,t)}},children:!l&&t})}},1840:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CreateListing}});var n=r(7437),i=r(2265),a=r(6055),s=r(2653),o=r(3226),c=r(9050),l=r(8874),u=r(1975),d=r(7127),g=r(9394),p=r(1797),h=r(6337),m=r(2834),f=r(7292),x=r(7070),b=r(5301),v=r(4086),j=r(148),y=r(5959),C=r(4145),w=r(3533),I=r(9396),Z=r(4033),U=r(6691),S=r.n(U);let k=["Furniture","Electronics","School Supplies","Home Decor","Clothing and Accessories","Appliances","Bicycles and Transportation","Textbooks","Sports and Fitness Equipment","Home Office","Miscellaneous"],A=["Los Angeles","San Diego","San Jose","San Francisco","San Luis Obispo","Pismo Beach","Morro Bay","Arroyo Grande","Atascadero","Paso Robles","Grover Beach","Cambria","Templeton","Nipomo","Cayucos"],ImageUploadSquare=e=>{let{image:t,onRemove:r}=e;return(0,n.jsx)(a.Z,{elevation:3,sx:{width:250,height:250,backgroundImage:"url(".concat(t.preview,")"),backgroundSize:"cover",backgroundPosition:"center",position:"relative","&:hover":{boxShadow:"0 0 10px rgba(0, 0, 0, 0.5)"}},children:(0,n.jsx)(s.Z,{onClick:r,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(255, 255, 255, 0.7)",color:"black","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"},zIndex:2},children:(0,n.jsx)(w.Z,{})})})};function CreateListing(){let e=(0,Z.useRouter)(),{getUser:t,isAuthenticated:r}=(0,y.useAuth)(),[a,w]=(0,i.useState)({title:"",description:"",created:"",price:0,location:""}),[U,P]=(0,i.useState)(null),[L,E]=(0,i.useState)([]),[F,O]=(0,i.useState)({open:!1,message:""}),[T,q]=(0,i.useState)(!1),[J,D]=(0,i.useState)([]),[N,R]=(0,i.useState)(!1),[B,z]=(0,i.useState)(null),M=(0,y.useAuth)(),V=null!==M.currentUser,[H,_]=(0,i.useState)(""),[Q,G]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(M.currentUser&&M.currentUser.reloadUserInfo){let e=M.currentUser.reloadUserInfo.customAttributes;if(e)try{let t=JSON.parse(e);G(!0===t.student)}catch(e){console.error("Error parsing customAttributes",e)}}},[M.currentUser]),(0,i.useEffect)(()=>{V||e.push("/login")},[V,e]);let handleChange=e=>{let{name:t,value:r}=e.target;if("price"===t){let e=parseFloat(r);if(isNaN(e)||e<0){O({open:!0,message:"Price must be a positive number."});return}if(!/^\d+(\.\d{0,2})?$/.test(r)){O({open:!0,message:"Price must not exceed two decimal places."});return}0===e&&O({open:!0,message:"The price will be registered as 'free'."}),w({...a,price:e})}else w({...a,[t]:r})},handleSubmit=async()=>{let r=validateForm();if(r){O({open:!0,message:r});return}try{if(!e||!V){console.error("Router is not defined or user is not logged in");return}let r=t();if(!r||!r.uid){console.error("No user found");return}let n=r.uid,i={title:a.title,description:a.description,price:a.price,location:a.location,images:[],createdAt:v.EK.fromDate(new Date),sellerId:n,studentVerification:Q,category:H};if(L.length){let e=await (0,C.Ix)(n,L[0].file);i.images.push(e)}let s=await (0,v.ET)((0,v.hJ)(j.db,"listings"),i);O({open:!0,message:"Listing created successfully!"}),z(s.id),R(!0),e.push("/listing/".concat(s.id))}catch(e){console.log(e),O({open:!0,message:e.message})}},validateForm=()=>a.title.trim()?a.description.trim()?null==a.price?"Price is required.":a.price<0?"Price cannot be negative.":/^\d+(\.\d{0,2})?$/.test(a.price.toString())?a.location?0===L.length?"At least one image is required.":"":"Location is required.":"Price must not exceed two decimal places.":"Description is required.":"Title is required.",removeImage=e=>{E(t=>t.filter((t,r)=>r!==e))},K=(0,i.useCallback)(e=>{E(t=>[...t,...e.map(e=>({file:e,preview:URL.createObjectURL(e)}))])},[]),{getRootProps:W,getInputProps:$}=(0,b.uI)({onDrop:K,maxFiles:10,accept:{"image/*":[".jpeg",".jpg",".png"]}});return N?(0,n.jsxs)("div",{style:{textAlign:"center",marginTop:"50px"},children:[(0,n.jsx)(S(),{src:"/../../assets/illustrations/sitting-4.svg",alt:"Listing Created",width:200,height:200}),(0,n.jsx)(o.Z,{variant:"h5",style:{marginTop:"20px"},children:"Listing Created Successfully!"}),(0,n.jsx)(c.Z,{variant:"contained",color:"primary",style:{marginTop:"20px"},onClick:()=>e.push("/listing/".concat(B)),children:"View Listing"})]}):(0,n.jsx)(l.ZP,{container:!0,justifyContent:"center",alignItems:"center",style:{padding:"40px"},children:(0,n.jsx)(l.ZP,{item:!0,xs:12,md:8,lg:6,children:(0,n.jsxs)("form",{style:{display:"flex",flexDirection:"column"},children:[" ",(0,n.jsx)("h1",{children:"New Listing"}),M.currentUser&&(0,n.jsx)(o.Z,{variant:"body1",style:{marginBottom:"1rem"},children:Q?"Your listing will be displayed with a student verification symbol.":"If you want to add student verification to your listing, please register your account as a student."}),(0,n.jsx)(u.Z,{autoFocus:!0,margin:"dense",id:"title",name:"title",label:"Listing Title",type:"text",variant:"outlined",onChange:handleChange,required:!0}),(0,n.jsxs)(l.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,n.jsx)(l.ZP,{item:!0,xs:4,children:(0,n.jsx)(u.Z,{autoFocus:!0,margin:"dense",id:"price",name:"price",label:"Price",type:"number",fullWidth:!0,variant:"outlined",onChange:handleChange,required:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:4,children:(0,n.jsx)(d.Z,{id:"location",required:!0,options:A,getOptionLabel:e=>e,renderInput:e=>(0,n.jsx)(u.Z,{...e,label:"Choose a city",variant:"outlined",fullWidth:!0}),value:U,onChange:(e,t)=>{P(t),w({...a,location:t})}})}),(0,n.jsx)(l.ZP,{item:!0,xs:4,children:(0,n.jsx)(d.Z,{id:"category",options:k,required:!0,getOptionLabel:e=>e,renderInput:e=>(0,n.jsx)(u.Z,{...e,label:"Category",variant:"outlined"}),value:H,onChange:(e,t)=>{_(t)}})})]}),(0,n.jsx)(u.Z,{autoFocus:!0,margin:"dense",id:"description",name:"description",label:"Description",type:"text",fullWidth:!0,variant:"outlined",onChange:handleChange,multiline:!0,rows:5,required:!0}),(0,n.jsx)("h3",{children:"Upload Images"}),(0,n.jsxs)(l.ZP,{container:!0,spacing:2,alignItems:"center",children:[L.map((e,t)=>(0,n.jsx)(l.ZP,{item:!0,children:(0,n.jsx)(ImageUploadSquare,{image:e,onRemove:()=>removeImage(t)})},t)),L.length<10&&(0,n.jsx)(l.ZP,{item:!0,children:(0,n.jsx)(s.Z,{onClick:()=>{q(!0)},sx:{width:250,height:250,border:"1px dashed grey",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:(0,n.jsx)(I.Z,{fontSize:"large"})})})]}),(0,n.jsxs)(g.Z,{open:T,onClose:()=>q(!1),children:[(0,n.jsx)(p.Z,{id:"responsive-dialog-title",children:"Upload Listing Image"}),(0,n.jsx)(h.Z,{children:(0,n.jsxs)("div",{...W(),style:{border:"1px dashed gray",padding:"6rem",cursor:"pointer"},children:[(0,n.jsx)("input",{...$()})," ",(0,n.jsx)(o.Z,{variant:"body1",children:"Drag & drop an image here, or click to select one"})]})}),(0,n.jsx)(m.Z,{children:(0,n.jsx)(c.Z,{autoFocus:!0,onClick:()=>{q(!1)},color:"primary",children:"Cancel"})})]}),(0,n.jsxs)("div",{align:"left",children:[(0,n.jsx)(c.Z,{sx:{marginTop:"3rem",backgroundColor:"grey"},variant:"contained",onClick:()=>{e.push("/")},children:"Cancel"}),(0,n.jsx)(c.Z,{sx:{marginTop:"3rem",marginLeft:"3rem",backgroundColor:"4FB18C"},onClick:handleSubmit,variant:"contained",children:"Create Listing"})]}),(0,n.jsx)(f.Z,{open:F.open,autoHideDuration:6e3,onClose:()=>O({...F,open:!1}),children:(0,n.jsx)(x.Z,{onClose:()=>O({...F,open:!1}),severity:"error",sx:{width:"100%"},children:F.message})})]})})})}},4145:function(e,t,r){"use strict";r.d(t,{Ix:function(){return uploadImage},Nq:function(){return updateUser},PR:function(){return getUser},r4:function(){return createUser}});var n=r(148),i=r(4086),a=r(9584);async function uploadImage(e,t){if(t.size>5e6)throw Error("Image cannot be more than 5 MB large");if(!/\.(jpeg|jpg|png)$/i.test(t.name))throw Error("Image has an invalid extension. Allowed: jpg, png");let r="".concat(Math.floor(1e8+9e8*Math.random()),".").concat(t.name.split(".").pop()),i="images/".concat(e,"/").concat(r),s=(0,a.iH)(n.tO,i);try{await (0,a.KV)(s,t);let e=await (0,a.Jt)(s);return e}catch(e){throw console.error("Error uploading image:",e),e}}async function createUser(e,t){let r=(0,i.JU)(n.db,"users",e),a=(0,i.JU)(n.db,"users",e,"private","contact"),s=(0,i.JU)(n.db,"users",e,"private","favorites");await (0,i.pl)(r,{isAdmin:!1,isStudent:!1,isVerified:!1,name:"",profileImage:"",heroImage:"",contactInfoVisibility:!1}).catch(e=>{throw e}),await (0,i.pl)(a,{email:t,phoneNumber:"",location:""}).catch(e=>{throw e}),await (0,i.pl)(s,{favoriteListings:[],favoriteUsers:[]}).catch(e=>{throw e})}async function getUser(e){let t=(0,i.JU)(n.db,"users",e),r=(0,i.JU)(n.db,"users",e,"private","contact"),a=(0,i.JU)(n.db,"users",e,"private","favorites"),s=null,o=null,c=null;return(await (0,i.QT)(t).then(e=>{e.exists()&&(s=e.data())}).catch(e=>{throw e}),s)?(await (0,i.QT)(r).then(e=>{e.exists()&&(o=e.data())}).catch(()=>{}),await (0,i.QT)(a).then(e=>{e.exists()&&(c=e.data())}).catch(()=>{}),{...s,...o,...c}):null}async function updateUser(e,t){let{email:r,isVerified:a,isAdmin:s,name:o,phoneNumber:c,location:l,profileImage:u,heroImage:d,isStudent:g,contactInfoVisibility:p,favoriteListings:h,favoriteUsers:m}=t,f={isAdmin:s,isStudent:g,isVerified:a,name:o,profileImage:u,heroImage:d,contactInfoVisibility:p},x={email:r,phoneNumber:c,location:l},b={favoriteListings:h,favoriteUsers:m};Object.keys(f).forEach(e=>void 0===f[e]&&delete f[e]),Object.keys(x).forEach(e=>void 0===x[e]&&delete x[e]),Object.keys(b).forEach(e=>void 0===b[e]&&delete b[e]);let v=(0,i.JU)(n.db,"users",e),j=(0,i.JU)(n.db,"users",e,"private","contact"),y=(0,i.JU)(n.db,"users",e,"private","favorites");f&&await (0,i.r7)(v,f),x&&await (0,i.r7)(j,x),b&&await (0,i.r7)(y,b)}}},function(e){e.O(0,[358,220,87,880,980,599,214,739,787,116,630,341,691,971,472,744],function(){return e(e.s=5136)}),_N_E=e.O()}]);