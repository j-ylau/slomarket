(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[237],{1975:function(e,t,r){"use strict";r.d(t,{Z:function(){return L}});var i,n=r(3428),a=r(791),s=r(2265),o=r(7042),l=r(5600),u=r(3449),d=r(5843),c=r(7927),p=r(1711),f=r(7328),m=r(923),g=r(819),h=r(4081),v=r(4379),b=r(9592),x=r(8702),y=r(6520),Z=r(5702);function getFormHelperTextUtilityClasses(e){return(0,Z.Z)("MuiFormHelperText",e)}let w=(0,y.Z)("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var U=r(7437);let I=["children","className","component","disabled","error","filled","focused","margin","required","variant"],useUtilityClasses=e=>{let{classes:t,contained:r,size:i,disabled:n,error:a,filled:s,focused:o,required:u}=e,d={root:["root",n&&"disabled",a&&"error",i&&`size${(0,x.Z)(i)}`,r&&"contained",o&&"focused",s&&"filled",u&&"required"]};return(0,l.Z)(d,getFormHelperTextUtilityClasses,t)},F=(0,d.ZP)("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,r.size&&t[`size${(0,x.Z)(r.size)}`],r.contained&&t.contained,r.filled&&t.filled]}})(({theme:e,ownerState:t})=>(0,n.Z)({color:(e.vars||e).palette.text.secondary},e.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${w.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${w.error}`]:{color:(e.vars||e).palette.error.main}},"small"===t.size&&{marginTop:4},t.contained&&{marginLeft:14,marginRight:14})),T=s.forwardRef(function(e,t){let r=(0,c.Z)({props:e,name:"MuiFormHelperText"}),{children:s,className:l,component:u="p"}=r,d=(0,a.Z)(r,I),p=(0,b.Z)(),f=(0,v.Z)({props:r,muiFormControl:p,states:["variant","size","disabled","error","filled","focused","required"]}),m=(0,n.Z)({},r,{component:u,contained:"filled"===f.variant||"outlined"===f.variant,variant:f.variant,size:f.size,disabled:f.disabled,error:f.error,filled:f.filled,focused:f.focused,required:f.required}),g=useUtilityClasses(m);return(0,U.jsx)(F,(0,n.Z)({as:u,ownerState:m,className:(0,o.Z)(g.root,l),ref:t},d,{children:" "===s?i||(i=(0,U.jsx)("span",{className:"notranslate",children:"â€‹"})):s}))});var j=r(654);function getTextFieldUtilityClass(e){return(0,Z.Z)("MuiTextField",e)}(0,y.Z)("MuiTextField",["root"]);let S=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],P={standard:p.Z,filled:f.Z,outlined:m.Z},TextField_useUtilityClasses=e=>{let{classes:t}=e;return(0,l.Z)({root:["root"]},getTextFieldUtilityClass,t)},C=(0,d.ZP)(h.Z,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),R=s.forwardRef(function(e,t){let r=(0,c.Z)({props:e,name:"MuiTextField"}),{autoComplete:i,autoFocus:s=!1,children:l,className:d,color:p="primary",defaultValue:f,disabled:m=!1,error:h=!1,FormHelperTextProps:v,fullWidth:b=!1,helperText:x,id:y,InputLabelProps:Z,inputProps:w,InputProps:I,inputRef:F,label:R,maxRows:L,minRows:A,multiline:q=!1,name:E,onBlur:k,onChange:J,onFocus:z,placeholder:M,required:N=!1,rows:O,select:H=!1,SelectProps:$,type:_,value:B,variant:D="outlined"}=r,Q=(0,a.Z)(r,S),V=(0,n.Z)({},r,{autoFocus:s,color:p,disabled:m,error:h,fullWidth:b,multiline:q,required:N,select:H,variant:D}),W=TextField_useUtilityClasses(V),K={};"outlined"===D&&(Z&&void 0!==Z.shrink&&(K.notched=Z.shrink),K.label=R),H&&($&&$.native||(K.id=void 0),K["aria-describedby"]=void 0);let G=(0,u.Z)(y),X=x&&G?`${G}-helper-text`:void 0,Y=R&&G?`${G}-label`:void 0,ee=P[D],et=(0,U.jsx)(ee,(0,n.Z)({"aria-describedby":X,autoComplete:i,autoFocus:s,defaultValue:f,fullWidth:b,multiline:q,name:E,rows:O,maxRows:L,minRows:A,type:_,value:B,id:G,inputRef:F,onBlur:k,onChange:J,onFocus:z,placeholder:M,inputProps:w},K,I));return(0,U.jsxs)(C,(0,n.Z)({className:(0,o.Z)(W.root,d),disabled:m,error:h,fullWidth:b,ref:t,required:N,color:p,variant:D,ownerState:V},Q,{children:[null!=R&&""!==R&&(0,U.jsx)(g.Z,(0,n.Z)({htmlFor:G,id:Y},Z,{children:R})),H?(0,U.jsx)(j.Z,(0,n.Z)({"aria-describedby":X,id:G,labelId:Y,value:B,input:et},$,{children:l})):et,x&&(0,U.jsx)(T,(0,n.Z)({id:X},v,{children:x}))]}))});var L=R},5570:function(e,t,r){Promise.resolve().then(r.bind(r,6139))},148:function(e,t,r){"use strict";r.d(t,{I8:function(){return l},db:function(){return u},tO:function(){return d}});var i=r(994);r(5073);var n=r(4086),a=r(9584),s=r(8153);let o=(0,i.ZF)({apiKey:"AIzaSyBjEHdFQZFsfN-RGa59n16XO7qQ4dhFsAo",authDomain:"slomarket-ebbd9.firebaseapp.com",projectId:"slomarket-ebbd9",storageBucket:"slomarket-ebbd9.appspot.com",messagingSenderId:"247606192779",appId:"1:247606192779:web:421bdc33c388c5c8e828e",measurementId:"G-E3DPKJ6L5V"}),l=(0,s.v0)(o),u=(0,n.ad)(o),d=(0,a.cF)(o)},5959:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return AuthProvider},useAuth:function(){return useAuth}});var i=r(7437),n=r(2265),a=r(148),s=r(8153);let o=(0,n.createContext)();function useAuth(){return(0,n.useContext)(o)}function AuthProvider(e){let{children:t}=e,[r,l]=(0,n.useState)(),[u,d]=(0,n.useState)(!0);async function isAdmin(){return await a.I8.currentUser.getIdTokenResult().then(e=>!!e.claims.admin).catch(e=>{throw e})}return(0,n.useEffect)(()=>{let e=a.I8.onAuthStateChanged(e=>{l(e),d(!1)},e=>{console.error("Authentication error:",e),d(!1)});return e},[]),(0,i.jsx)(o.Provider,{value:{currentUser:r,getUser:function(){return a.I8.currentUser},isLoggedIn:function(){return null!==a.I8.currentUser},isAdmin,login:function(e,t){return a.I8.signInWithEmailAndPassword(e,t)},signOut:function(){return a.I8.signOut()},signUp:function(e,t){return(0,s.Xb)(a.I8,e,t)}},children:!u&&t})}},6139:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return EditListing}});var i=r(7437),n=r(4033),a=r(2265),s=r(4086),o=r(148),l=r(5959),u=r(8874),d=r(1975),c=r(9050);function EditListing(){let e=(0,n.useRouter)(),{id:t}=(0,n.useParams)(),{getUser:r,isAuthenticated:p}=(0,l.useAuth)(),[f,m]=(0,a.useState)(null),[g,h]=(0,a.useState)({open:!1,message:""}),[v,b]=(0,a.useState)(""),[x,y]=(0,a.useState)(""),[Z,w]=(0,a.useState)([]),[U,I]=(0,a.useState)(!1),[F,T]=(0,a.useState)(!1),[j,S]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let fetchListing=async()=>{if(!t)return;let e=(0,s.JU)(o.db,"listings",t),r=await (0,s.QT)(e);if(r.exists()){let e=r.data();m({title:e.title,description:e.description,price:e.price,location:e.location,category:e.category}),b(e.location),y(e.category)}else console.error("No such listing!");S(!1)};fetchListing()},[t]);let handleSubmit=async()=>{let r=validateForm();if(r){h({open:!0,message:r});return}T(!0);try{let r=(0,s.JU)(o.db,"listings",t);await (0,s.r7)(r,{...f,location:v,category:x,updatedAt:a.Timestamp.fromDate(new Date)}),h({open:!0,message:"Listing updated successfully!"}),T(!1),e.push("/listing/".concat(t))}catch(e){console.error(e),h({open:!0,message:e.message}),T(!1)}};(0,a.useCallback)(e=>{setListingImage(t=>[...t,...e.map(e=>({file:e,preview:URL.createObjectURL(e)}))])},[]);let validateForm=()=>f.title.trim()?f.description.trim()?null==f.price?"Price is required.":f.price<0?"Price cannot be negative.":/^\d+(\.\d{0,2})?$/.test(f.price.toString())?f.location?0===listingImage.length?"At least one image is required.":"":"Location is required.":"Price must not exceed two decimal places.":"Description is required.":"Title is required.";return j?(0,i.jsx)("div",{children:"Loading..."}):f?(0,i.jsx)(u.ZP,{container:!0,justifyContent:"center",alignItems:"center",style:{padding:"40px"},children:(0,i.jsx)(u.ZP,{item:!0,xs:12,md:8,lg:6,children:(0,i.jsxs)("form",{onSubmit:handleSubmit,style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)(d.Z,{autoFocus:!0,margin:"dense",id:"title",name:"title",label:"Listing Title",type:"text",variant:"outlined",value:f.title,onChange:e=>{let{name:t,value:r}=e.target;m({...f,[t]:r})},required:!0}),(0,i.jsx)(c.Z,{type:"submit",color:"primary",variant:"contained",disabled:F,children:F?"Updating...":"Update Listing"})]})})}):(0,i.jsx)("div",{children:"Listing not found or you do not have permission to edit it."})}r(4145),r(6691)},4145:function(e,t,r){"use strict";r.d(t,{Ix:function(){return uploadImage},Nq:function(){return updateUser},PR:function(){return getUser},r4:function(){return createUser}});var i=r(148),n=r(4086),a=r(9584);async function uploadImage(e,t){if(t.size>5e6)throw Error("Image cannot be more than 5 MB large");if(!/\.(jpeg|jpg|png)$/i.test(t.name))throw Error("Image has an invalid extension. Allowed: jpg, png");let r="".concat(Math.floor(1e8+9e8*Math.random()),".").concat(t.name.split(".").pop()),n="images/".concat(e,"/").concat(r),s=(0,a.iH)(i.tO,n);try{await (0,a.KV)(s,t);let e=await (0,a.Jt)(s);return e}catch(e){throw console.error("Error uploading image:",e),e}}async function createUser(e,t){let r=(0,n.JU)(i.db,"users",e),a=(0,n.JU)(i.db,"users",e,"private","contact"),s=(0,n.JU)(i.db,"users",e,"private","favorites");await (0,n.pl)(r,{isAdmin:!1,isStudent:!1,isVerified:!1,name:"",profileImage:"",heroImage:"",contactInfoVisibility:!1}).catch(e=>{throw e}),await (0,n.pl)(a,{email:t,phoneNumber:"",location:""}).catch(e=>{throw e}),await (0,n.pl)(s,{favoriteListings:[],favoriteUsers:[]}).catch(e=>{throw e})}async function getUser(e){let t=(0,n.JU)(i.db,"users",e),r=(0,n.JU)(i.db,"users",e,"private","contact"),a=(0,n.JU)(i.db,"users",e,"private","favorites"),s=null,o=null,l=null;return(await (0,n.QT)(t).then(e=>{e.exists()&&(s=e.data())}).catch(e=>{throw e}),s)?(await (0,n.QT)(r).then(e=>{e.exists()&&(o=e.data())}).catch(()=>{}),await (0,n.QT)(a).then(e=>{e.exists()&&(l=e.data())}).catch(()=>{}),{...s,...o,...l}):null}async function updateUser(e,t){let{email:r,isVerified:a,isAdmin:s,name:o,phoneNumber:l,location:u,profileImage:d,heroImage:c,isStudent:p,contactInfoVisibility:f,favoriteListings:m,favoriteUsers:g}=t,h={isAdmin:s,isStudent:p,isVerified:a,name:o,profileImage:d,heroImage:c,contactInfoVisibility:f},v={email:r,phoneNumber:l,location:u},b={favoriteListings:m,favoriteUsers:g};Object.keys(h).forEach(e=>void 0===h[e]&&delete h[e]),Object.keys(v).forEach(e=>void 0===v[e]&&delete v[e]),Object.keys(b).forEach(e=>void 0===b[e]&&delete b[e]);let x=(0,n.JU)(i.db,"users",e),y=(0,n.JU)(i.db,"users",e,"private","contact"),Z=(0,n.JU)(i.db,"users",e,"private","favorites");h&&await (0,n.r7)(x,h),v&&await (0,n.r7)(y,v),b&&await (0,n.r7)(Z,b)}}},function(e){e.O(0,[358,220,87,880,980,599,739,691,971,472,744],function(){return e(e.s=5570)}),_N_E=e.O()}]);