(()=>{var e={};e.id=7413,e.ids=[7413],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},96206:e=>{"use strict";e.exports=require("console")},6113:e=>{"use strict";e.exports=require("crypto")},67643:e=>{"use strict";e.exports=require("diagnostics_channel")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},15673:e=>{"use strict";e.exports=require("node:events")},84492:e=>{"use strict";e.exports=require("node:stream")},47261:e=>{"use strict";e.exports=require("node:util")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},4074:e=>{"use strict";e.exports=require("perf_hooks")},77282:e=>{"use strict";e.exports=require("process")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},35356:e=>{"use strict";e.exports=require("stream/web")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},29830:e=>{"use strict";e.exports=require("util/types")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},70522:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.a,__next_app__:()=>d,originalPathname:()=>p,pages:()=>u,routeModule:()=>h,tree:()=>c});var s=t(67096),i=t(16132),n=t(37284),o=t.n(n),a=t(32564),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);t.d(r,l);let c=["",{children:["setup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,34500)),"/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,96109)),"/Users/jlau/Code-2023/cpmarketplace/src/app/layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js"],p="/setup/page",d={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/setup/page",pathname:"/setup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},73098:(e,r,t)=>{Promise.resolve().then(t.bind(t,44187))},44187:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>Profile});var s=t(30784),i=t(9885),n=t(81932),o=t.n(n),a=t(16614),l=t.n(a),c=t(21971),u=t.n(c),p=t(33987),d=t.n(p),h=t(48060),x=t.n(h),m=t(52694),g=t.n(m),j=t(95843),b=t.n(j),f=t(92870),v=t.n(f),y=t(45003),q=t.n(y),P=t(62969),_=t.n(P),C=t(42153),k=t.n(C),S=t(16856),w=t.n(S),I=t(95915),D=t.n(I),R=t(29300),N=t(96686),U=t(64622),L=t(57114),A=t(18282),$=t(39358),B=t(96106);let E=["Los Angeles","San Diego","San Jose","San Francisco","San Luis Obispo","Pismo Beach","Morro Bay","Arroyo Grande","Atascadero","Paso Robles","Grover Beach","Cambria","Templeton","Nipomo","Cayucos"];function Profile(){let[e,r]=(0,i.useState)({}),[t,n]=(0,i.useState)(),[a,c]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),[m,j]=(0,i.useState)([]),[f,y]=(0,i.useState)([]),[P,C]=(0,i.useState)(!1),[S,I]=(0,i.useState)(!1),[F,G]=(0,i.useState)(""),{getUser:z,isLoggedIn:M}=(0,A.useAuth)(),O=(0,L.useRouter)(),T=(0,i.useCallback)(e=>{let r=e[0],t=URL.createObjectURL(r);j([r,t]),C(!1)},[]),V=(0,i.useCallback)(e=>{let r=e[0],t=URL.createObjectURL(r);y([r,t]),I(!1)},[]),{getRootProps:Y,getInputProps:H}=(0,U.useDropzone)({onDrop:T,maxFiles:1,accept:{"image/*":[".jpeg",".jpg",".png"]}}),{getRootProps:W,getInputProps:Z}=(0,U.useDropzone)({onDrop:V,maxFiles:1,accept:{"image/*":[".jpeg",".jpg",".png"]}}),handleProfileImageDialogClose=()=>{C(!1)},handleHeroDialogClose=()=>{I(!1)},resendVerificationEmail=async()=>{let e=z();await (0,$.w$)(e).catch(e=>{console.error(e),n(e.message)})};async function handleSetupSubmit(t){t.preventDefault();let s=new FormData(t.currentTarget),i=s.get("name"),o=s.get("phoneNumber"),a=s.get("location"),l=z(),c=l.uid;if(!t.currentTarget.reportValidity())return n("Keep name and location under 64 characters, and phone number under 16 characters."),!1;if(o&&!o.match(/^(\+\d{1,2}\s?)?1?\-?\.?\s?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/))return n(),r({...e,phoneNumber:{error:!0,message:"Your phone number is not formatted correctly."}}),!1;let u="",p="";if(0!=m.length)try{u=await (0,B.Ix)(c,m[0])}catch(e){return console.error(e),n(e.message),!1}if(0!=f.length)try{p=await (0,B.Ix)(c,f[0])}catch(e){return console.error(e),n(e.message),!1}return(await (0,B.Nq)(c,{name:i,phoneNumber:o,location:F,profileImage:u,heroImage:p}).then(()=>{O.push(`/profile/${c}`)}).catch(e=>{console.error(e),n(e.message)}),i&&o&&a)?o&&!o.match(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/)&&(n("Your phone number is not formatted correctly."),r({...e,phoneNumber:{error:!0,message:"Your phone number is not formatted correctly."}})):n("Please fill in all required fields."),!1}return(0,i.useEffect)(()=>{if(!M()){O.push("/login");return}let e=z();"calpoly.edu"==e.email.split("@").pop()&&(c(!0),e.emailVerified&&h(!0))},[]),(0,i.useEffect)(()=>{let e=setInterval(()=>{if(M()){z().reload();let r=z();r.emailVerified&&(fetch(`/api/verify/${r.uid}`,{method:"put"}).catch(e=>{console.error(e),n(e.error)}),h(!0),clearInterval(e))}},2e3);return()=>clearInterval(e)},[]),(0,s.jsxs)("div",{style:{height:"100vh"},children:[s.jsx("h1",{style:{textAlign:"center"},children:"Set Up Profile"}),(0,s.jsxs)("form",{onSubmit:handleSetupSubmit,style:{padding:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[a&&!p&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(o(),{severity:"warning",children:"Check your email to verify your student status!"}),s.jsx(l(),{onClick:resendVerificationEmail,children:"Resend email"})]}),a&&p&&s.jsx(o(),{severity:"success",children:"Your email has been verified!"}),t&&s.jsx(o(),{severity:"error",children:t}),(0,s.jsxs)(u(),{container:!0,spacing:2,columnSpacing:8,alignItems:"center",justifyContent:"center",mt:3,children:[(0,s.jsxs)(u(),{item:!0,children:[s.jsx(d(),{align:"center",children:"Profile Picture"}),s.jsx(x(),{onClick:()=>{C(!0)},children:s.jsx(g(),{elevation:3,sx:{width:100,height:100,backgroundImage:`url(${m[1]})`,backgroundSize:"cover",backgroundPosition:"center",position:"relative",borderRadius:"50%"},children:!m[1]&&s.jsx(b(),{alt:"Banner",sx:{width:100,height:100},variant:"circular",children:s.jsx(R.Z,{})})})})]}),(0,s.jsxs)(u(),{item:!0,children:[s.jsx(d(),{align:"center",children:"Banner Image"}),s.jsx(x(),{onClick:()=>{I(!0)},sx:{borderRadius:0},children:s.jsx(g(),{elevation:3,sx:{width:200,height:100,backgroundImage:`url(${f[1]})`,backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:!f[1]&&s.jsx(b(),{alt:"Banner",sx:{width:200,height:100},variant:"square",children:s.jsx(N.Z,{})})})})]})]}),s.jsx("br",{}),(0,s.jsxs)("div",{style:{width:"30%"},children:[s.jsx(v(),{margin:"dense",variant:"outlined",id:"name",name:"name",label:"Name",type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:64}}),s.jsx("br",{}),s.jsx(v(),{margin:"dense",name:"phoneNumber",id:"phoneNumber",label:"Phone Number",type:"tel",fullWidth:!0,required:!0,error:e.phoneNumber?.error,helperText:e.phoneNumber?.message,variant:"outlined",inputProps:{maxLength:16}}),s.jsx("br",{}),s.jsx(q(),{value:F,onChange:(e,r)=>{G(r)},id:"location",options:E,getOptionLabel:e=>e,renderInput:e=>s.jsx(v(),{...e,label:"Location",margin:"dense",variant:"outlined",required:!0})}),s.jsx("br",{}),s.jsx("br",{}),s.jsx(l(),{type:"submit",variant:"contained",sx:{backgroundColor:"4FB18C"},children:"Complete Setup"})]})]}),(0,s.jsxs)(_(),{open:P,onClose:handleProfileImageDialogClose,"aria-labelledby":"responsive-dialog-title",children:[s.jsx(k(),{id:"responsive-dialog-title",children:"Upload Profile Image"}),s.jsx(w(),{children:(0,s.jsxs)("div",{...Y(),style:{border:"1px dashed gray",padding:"20px",cursor:"pointer"},children:[s.jsx("input",{...H()}),s.jsx(d(),{variant:"body1",children:"Drag & drop an image here, or click to select one"})]})}),s.jsx(D(),{children:s.jsx(l(),{autoFocus:!0,onClick:handleProfileImageDialogClose,color:"primary",children:"Cancel"})})]}),(0,s.jsxs)(_(),{open:S,onClose:handleHeroDialogClose,"aria-labelledby":"responsive-dialog-title",children:[s.jsx(k(),{id:"responsive-dialog-title",children:"Upload Banner Image"}),s.jsx(w(),{children:(0,s.jsxs)("div",{...W(),style:{border:"1px dashed gray",padding:"20px",cursor:"pointer"},children:[s.jsx("input",{...Z()}),s.jsx(d(),{variant:"body1",children:"Drag & drop an image here, or click to select one"})]})}),s.jsx(D(),{children:s.jsx(l(),{autoFocus:!0,onClick:handleHeroDialogClose,color:"primary",children:"Cancel"})})]})]})}},34500:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>n,default:()=>l});var s=t(95153);let i=(0,s.createProxy)(String.raw`/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js`),{__esModule:n,$$typeof:o}=i,a=i.default,l=a}};var r=require("../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,6120,8153,1323,4359,3234,2870,2133,5915,7791,9781,402,2291],()=>__webpack_exec__(70522));module.exports=t})();